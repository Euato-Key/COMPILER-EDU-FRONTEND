<template>
  <div class="string-analysis-step">
    <div class="step-header">
      <div class="flex items-center gap-4">
        <div class="step-icon">
          <Icon icon="lucide:play-circle" class="w-6 h-6 text-green-600" />
        </div>
        <div>
          <h2 class="text-2xl font-bold text-gray-900">å­—ç¬¦ä¸²åˆ†æ</h2>
          <p class="text-gray-600 mt-1">ç¬¬å››æ­¥ï¼šä½¿ç”¨LL1åˆ†æè¡¨åˆ†æè¾“å…¥å­—ç¬¦ä¸²</p>
        </div>
      </div>
    </div>

    <div class="step-content">
      <div class="max-w-6xl mx-auto">
        <!-- å½“å‰æ–‡æ³•åˆ†æç»“æœ -->
        <div v-if="originalData"
          class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 border-2 border-blue-200 rounded-xl p-6 shadow-xl mb-6">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                <Icon icon="lucide:zap" class="w-5 h-5 text-white" />
              </div>
              <div>
                <h4
                  class="text-lg font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                  å½“å‰æ–‡æ³•åˆ†æç»“æœ
                </h4>
                <p class="text-xs text-gray-600 mt-0.5">LL(1)æ–‡æ³•åˆ†æå®Œæˆ</p>
              </div>
            </div>
            <div
              class="flex items-center gap-2 px-3 py-1.5 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full shadow-lg">
              <Icon icon="lucide:check-circle" class="w-3 h-3 text-white" />
              <span class="text-xs font-semibold text-white">LL(1)æ–‡æ³•</span>
            </div>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- å·¦ä¾§ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="lg:col-span-1 flex flex-col">
              <div class="grid grid-cols-2 gap-4 flex-1">
                <div
                  class="bg-white rounded-lg p-4 border-2 border-blue-200 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex flex-col justify-center">
                  <div class="flex items-center gap-2 mb-3">
                    <div
                      class="w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                      <Icon icon="lucide:play" class="w-4 h-4 text-white" />
                    </div>
                    <span class="text-sm font-semibold text-gray-800">èµ·å§‹ç¬¦å·</span>
                  </div>
                  <p
                    class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent font-mono">
                    {{ originalData.S }}</p>
                </div>

                <div
                  class="bg-white rounded-lg p-4 border-2 border-purple-200 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex flex-col justify-center">
                  <div class="flex items-center gap-2 mb-3">
                    <div
                      class="w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center">
                      <Icon icon="lucide:tag" class="w-4 h-4 text-white" />
                    </div>
                    <span class="text-sm font-semibold text-gray-800">éç»ˆç»“ç¬¦</span>
                  </div>
                  <p
                    class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-purple-700 bg-clip-text text-transparent font-mono">
                    {{ originalData.Vn.length }}</p>
                  <p class="text-xs text-gray-600 mt-1 font-mono">{{ originalData.Vn.join(', ') }}</p>
                </div>

                <div
                  class="bg-white rounded-lg p-4 border-2 border-green-200 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex flex-col justify-center">
                  <div class="flex items-center gap-2 mb-3">
                    <div
                      class="w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                      <Icon icon="lucide:hash" class="w-4 h-4 text-white" />
                    </div>
                    <span class="text-sm font-semibold text-gray-800">ç»ˆç»“ç¬¦</span>
                  </div>
                  <p
                    class="text-2xl font-bold bg-gradient-to-r from-green-600 to-green-700 bg-clip-text text-transparent font-mono">
                    {{ originalData.Vt.length }}</p>
                  <p class="text-xs text-gray-600 mt-1 font-mono">{{ originalData.Vt.join(', ') }}</p>
                </div>

                <div
                  class="bg-white rounded-lg p-4 border-2 border-orange-200 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 flex flex-col justify-center">
                  <div class="flex items-center gap-2 mb-3">
                    <div
                      class="w-8 h-8 bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg flex items-center justify-center">
                      <Icon icon="lucide:list" class="w-4 h-4 text-white" />
                    </div>
                    <span class="text-sm font-semibold text-gray-800">äº§ç”Ÿå¼æ•°</span>
                  </div>
                  <p
                    class="text-2xl font-bold bg-gradient-to-r from-orange-600 to-orange-700 bg-clip-text text-transparent font-mono">
                    {{ Object.keys(originalData.formulas_dict).length }}
                  </p>
                </div>
              </div>
            </div>

            <!-- å³ä¾§æ–‡æ³•ä¿¡æ¯ -->
            <div class="lg:col-span-1">
              <div class="bg-white rounded-lg border-2 border-blue-200 p-4 shadow-lg h-full flex flex-col">
                <div class="flex items-center gap-2 mb-4">
                  <div
                    class="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                    <Icon icon="lucide:file-text" class="w-4 h-4 text-white" />
                  </div>
                  <div>
                    <h5
                      class="text-base font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
                      æ–‡æ³•ä¿¡æ¯
                    </h5>
                    <p class="text-xs text-gray-500">Grammar Information</p>
                  </div>
                </div>
                <div class="space-y-1.5 flex-1">
                  <div v-for="(productions, nonTerminal) in originalData.formulas_dict" :key="nonTerminal"
                    class="flex items-center gap-2 p-2 bg-gradient-to-r from-gray-50 to-gray-100 rounded-md border border-gray-200 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:border-blue-300 transition-all duration-200">
                    <span
                      class="text-sm font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent font-mono">{{
                      nonTerminal }}</span>
                    <span class="text-gray-400 font-mono text-sm">â†’</span>
                    <span class="font-mono text-gray-700 text-xs flex-1">{{ productions.join(' | ') }}</span>
                  </div>
                </div>

                <!-- å½“å‰è¾“å…¥ä¸²ä¿¡æ¯ -->
                <div v-if="inputString && inputAnalysisResult" class="mt-4 pt-4 border-t border-gray-200">
                  <div class="flex items-center gap-2 mb-3">
                    <div
                      class="w-6 h-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                      <Icon icon="lucide:play" class="w-3 h-3 text-white" />
                    </div>
                    <h6
                      class="text-sm font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                      å½“å‰è¾“å…¥ä¸²åˆ†æç»“æœ
                    </h6>
                  </div>
                  <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 border border-green-200">
                    <!-- è¾“å…¥ä¸²æ˜¾ç¤º -->
                    <div class="flex items-center justify-between mb-3">
                      <div class="flex items-center gap-2">
                        <span class="text-xs font-medium text-gray-600">è¾“å…¥ä¸²ï¼š</span>
                        <span class="text-sm font-mono text-green-700 bg-white px-2 py-1 rounded border">{{ inputString
                          }}</span>
                      </div>
                      <div class="flex items-center gap-2">
                        <Icon
                          :icon="inputAnalysisResult.info_res === 'Success!' ? 'lucide:check-circle' : 'lucide:x-circle'"
                          class="w-4 h-4"
                          :class="inputAnalysisResult.info_res === 'Success!' ? 'text-green-600' : 'text-red-600'" />
                        <span class="text-xs font-semibold px-2 py-1 rounded-full"
                          :class="inputAnalysisResult.info_res === 'Success!' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
                          {{ inputAnalysisResult.info_res === 'Success!' ? 'åˆ†ææˆåŠŸ' : 'åˆ†æå¤±è´¥' }}
                        </span>
                      </div>
                    </div>

                    <!-- åˆ†æè¯¦æƒ… -->
                    <div class="space-y-2">
                      <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-600">åˆ†ææ­¥éª¤ï¼š</span>
                        <span class="font-mono font-medium text-gray-800">{{ inputAnalysisResult.info_step.length }}
                          æ­¥</span>
                      </div>
                      <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-600">æœ€ç»ˆç»“æœï¼š</span>
                        <span class="font-mono font-medium"
                          :class="inputAnalysisResult.info_res === 'Success!' ? 'text-green-700' : 'text-red-700'">
                          {{ inputAnalysisResult.info_res }}
                        </span>
                      </div>
                      <div v-if="inputAnalysisResult.info_res !== 'Success!'"
                        class="flex items-center justify-between text-xs">
                        <span class="text-gray-600">é”™è¯¯ä¿¡æ¯ï¼š</span>
                        <span class="font-mono font-medium text-red-700 max-w-32 truncate"
                          :title="inputAnalysisResult.info_res">
                          {{ inputAnalysisResult.info_res }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- è¾“å…¥ä¸²åˆ†æåŒºåŸŸ -->
        <div v-if="originalData"
          class="bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 rounded-xl shadow-lg border border-green-100 p-6 mb-6">
          <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
                <Icon icon="lucide:play-circle" class="w-5 h-5 text-white" />
              </div>
              <div>
                <h3
                  class="text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
                  è¾“å…¥ä¸²åˆ†æ
                </h3>
                <p class="text-sm text-gray-600 mt-1">ä½¿ç”¨LL1åˆ†æè¡¨åˆ†æè¾“å…¥å­—ç¬¦ä¸²</p>
              </div>
            </div>
            <div class="flex items-center gap-2 px-3 py-1.5 bg-green-100 rounded-full">
              <Icon icon="lucide:info" class="w-3 h-3 text-green-600" />
              <span class="text-xs font-medium text-green-700">è‡ªåŠ¨æ·»åŠ ç»“æŸç¬¦#</span>
            </div>
          </div>

          <div class="space-y-6">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="bg-white rounded-lg border border-green-200 p-4 shadow-sm">
              <label class="block text-sm font-semibold text-gray-800 mb-3 flex items-center gap-2">
                <Icon icon="lucide:keyboard" class="w-4 h-4 text-green-500" />
                å­—ç¬¦ä¸²è¾“å…¥
                <span class="text-xs font-normal text-gray-500 ml-2">(ç»“æŸç¬¦ # ä¼šè‡ªåŠ¨æ·»åŠ )</span>
              </label>
              <div class="flex gap-4">
                <input v-model="inputString" type="text" placeholder="ä¾‹å¦‚: ab (ä¸éœ€è¦è¾“å…¥ç»“æŸç¬¦#)"
                  class="flex-1 px-4 py-3 border-2 border-green-200 rounded-lg focus:ring-4 focus:ring-green-100 focus:border-green-400 transition-all duration-200 font-mono text-sm"
                  @keyup.enter="analyzeString" />
                <button @click="analyzeString" :disabled="!inputString.trim() || analyzing"
                  class="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 disabled:opacity-50 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105">
                  <Icon v-if="analyzing" icon="lucide:loader-2" class="w-4 h-4 animate-spin mr-2" />
                  {{ analyzing ? 'åˆ†æä¸­...' : 'å¼€å§‹åˆ†æ' }}
                </button>
                <button @click="resetAnalysis"
                  class="px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all duration-200 font-semibold">
                  é‡ç½®
                </button>
              </div>
              <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-start gap-2 text-sm text-blue-700">
                  <Icon icon="lucide:lightbulb" class="w-4 h-4 mt-0.5 flex-shrink-0" />
                  <div>
                    <p class="font-medium mb-1">ğŸ’¡ åˆ†ææç¤º</p>
                    <p class="text-sm">â€¢ è¾“å…¥çš„å­—ç¬¦ä¸²æœ«å°¾ä¼šè‡ªåŠ¨æ·»åŠ ç»“æŸç¬¦ # è¿›è¡ŒLL1åˆ†æ</p>
                    <p class="text-sm">â€¢ ç³»ç»Ÿä¼šæ ¹æ®LL1åˆ†æè¡¨é€æ­¥åˆ†æå­—ç¬¦ä¸²çš„æ¨å¯¼è¿‡ç¨‹</p>
                    <p class="text-sm">â€¢ åˆ†æç»“æœå°†æ˜¾ç¤ºè¯¦ç»†çš„æ ˆæ“ä½œå’Œæ¨å¯¼æ­¥éª¤</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- ç¤ºä¾‹å­—ç¬¦ä¸² -->
            <div class="bg-white rounded-lg border border-green-200 p-4 shadow-sm">
              <div class="flex items-center gap-2 mb-3">
                <Icon icon="lucide:list" class="w-4 h-4 text-green-500" />
                <span class="text-sm font-semibold text-gray-800">ç¤ºä¾‹å­—ç¬¦ä¸²</span>
                <span class="text-xs text-gray-500">(ç‚¹å‡»ä½¿ç”¨)</span>
              </div>
              <div class="flex flex-wrap gap-2">
                <button v-for="example in exampleStrings" :key="example" @click="inputString = example"
                  class="px-4 py-2 text-sm bg-gradient-to-r from-gray-50 to-gray-100 text-gray-700 rounded-lg hover:from-gray-100 hover:to-gray-200 transition-all duration-200 border border-gray-200 hover:border-gray-300 font-mono">
                  {{ example }}
                </button>
              </div>
            </div>


          </div>
        </div>

        <!-- LL1åˆ†æè¡¨å’Œç­”é¢˜åŒºåŸŸ -->
        <div v-if="originalData?.table && inputString && inputAnalysisResult"
          class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- å·¦ä¾§ï¼šLL1åˆ†æè¡¨ -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
              <Icon icon="lucide:table" class="w-5 h-5 mr-2 text-blue-600" />
              LL1 åˆ†æè¡¨
            </h3>
            <div class="overflow-x-auto">
              <table class="min-w-full border border-gray-300">
                <thead class="bg-blue-50">
                  <tr>
                    <th class="border border-gray-300 px-3 py-2 text-left text-xs font-medium text-gray-700">
                      éç»ˆç»“ç¬¦
                    </th>
                    <th v-for="terminal in VtAll" :key="terminal"
                      class="border border-gray-300 px-3 py-2 text-center text-xs font-medium text-gray-700">
                      {{ terminal }}
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white">
                  <tr v-for="nonTerminal in originalData.Vn" :key="nonTerminal">
                    <td class="border border-gray-300 px-3 py-2 font-mono font-semibold text-blue-700">
                      {{ nonTerminal }}
                    </td>
                    <td v-for="terminal in VtAll" :key="`${nonTerminal}-${terminal}`"
                      :data-table-cell="`${nonTerminal}|${terminal}`"
                      class="border border-gray-300 px-3 py-2 text-center text-xs font-mono transition-colors" :class="{
                        'cursor-pointer hover:bg-blue-50': !isAnalysisComplete,
                        'cursor-not-allowed opacity-50': isAnalysisComplete,
                        'bg-yellow-100 ring-2 ring-yellow-400': hintActive && hintRow === nonTerminal && hintCol === terminal
                      }" @dblclick="onLL1CellDblClick(nonTerminal, terminal)">
                      <span v-if="originalData?.table && originalData.table[`${nonTerminal}|${terminal}`]"
                        class="text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded border">
                        {{ nonTerminal }}->{{ originalData.table[`${nonTerminal}|${terminal}`] }}
                      </span>
                      <span v-else class="text-gray-400">-</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
              <div class="flex items-start gap-2 text-sm text-blue-700">
                <Icon icon="lucide:info" class="w-4 h-4 mt-0.5 flex-shrink-0" />
                <div>
                  <p class="font-medium mb-1">ğŸ’¡ æ“ä½œæç¤º</p>
                  <p class="text-sm">â€¢ <span class="font-bold">åŒå‡»</span>è¡¨æ ¼ä¸­çš„äº§ç”Ÿå¼å¯è¿›è¡Œæ¨å¯¼æ“ä½œ</p>
                  <p class="text-sm">â€¢ æ ¹æ®å½“å‰åˆ†ææ ˆæ ˆé¡¶ç¬¦å·å’Œè¾“å…¥ä¸²é¦–å­—ç¬¦é€‰æ‹©æ­£ç¡®çš„æ“ä½œ</p>
                </div>
              </div>
            </div>

            <!-- ç¬¦å·å¡ç‰‡æ˜¾ç¤º -->
            <div class="mt-4 grid grid-cols-2 gap-4">
              <!-- éç»ˆç»“ç¬¦å¡ç‰‡ -->
              <div
                class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-lg border border-purple-200 p-4 shadow-sm">
                <div class="flex items-center gap-2 mb-3">
                  <div
                    class="w-6 h-6 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <Icon icon="lucide:tag" class="w-3 h-3 text-white" />
                  </div>
                  <span class="text-sm font-semibold text-purple-800">éç»ˆç»“ç¬¦ Vn</span>
                </div>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span v-for="nonTerminal in originalData.Vn" :key="nonTerminal" :data-symbol="nonTerminal"
                    class="px-3 py-1.5 bg-purple-100 text-purple-700 rounded-full text-sm font-mono font-semibold border border-purple-200 shadow-sm">
                    {{ nonTerminal }}
                  </span>
                </div>
              </div>

              <!-- ç»ˆç»“ç¬¦å¡ç‰‡ -->
              <div
                class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200 p-4 shadow-sm">
                <div class="flex items-center gap-2 mb-3">
                  <div
                    class="w-6 h-6 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center">
                    <Icon icon="lucide:hash" class="w-3 h-3 text-white" />
                  </div>
                  <span class="text-sm font-semibold text-green-800">ç»ˆç»“ç¬¦ Vt</span>
                </div>
                <div class="flex flex-wrap gap-2 justify-center">
                  <span v-for="terminal in originalData.Vt" :key="terminal" :data-symbol="terminal"
                    class="px-3 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-mono font-semibold border border-green-200 shadow-sm">
                    {{ terminal }}
                  </span>
                  <!-- ç»“æŸç¬¦ # -->
                  <span data-symbol="#"
                    class="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-full text-sm font-mono font-semibold border border-blue-200 shadow-sm">
                    #
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- å³ä¾§ï¼šç­”é¢˜åŒºåŸŸ -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <div class="mb-4">
              <div
                class="bg-yellow-50 border border-yellow-300 rounded-lg px-4 py-3 flex items-start gap-2 text-yellow-800 text-sm">
                <Icon icon="lucide:info" class="w-5 h-5 flex-shrink-0 mt-0.5 text-yellow-500" />
                <div>
                  <div class="font-bold mb-1">æ“ä½œæŒ‡å¼•ï¼š</div>
                  <ul class="list-disc list-inside space-y-1">
                    <li>è‹¥æ ˆé¡¶ä¸ºéç»ˆç»“ç¬¦ï¼ŒåŒå‡»å·¦ä¾§ LL1 åˆ†æè¡¨å¯¹åº”å•å…ƒæ ¼è¿›è¡Œæ¨å¯¼ã€‚</li>
                    <li>è‹¥æ ˆé¡¶ä¸è¾“å…¥ä¸²é¦–å­—ç¬¦ç›¸åŒï¼Œç‚¹å‡» <span class="font-bold text-green-700">åŒ¹é…</span> æŒ‰é’®ã€‚</li>
                    <li>å¦‚æ“ä½œå¤±è¯¯å¯ç‚¹å‡» <span class="font-bold text-gray-700">å›é€€</span>ï¼Œé‡æ–°å¼€å§‹å¯ç‚¹ <span
                        class="font-bold text-gray-700">é‡åš</span>ã€‚</li>
                    <li>é‡åˆ°ä¸ä¼šåšæ—¶å¯ç‚¹å‡» <span class="font-bold text-yellow-700">æç¤º</span>ï¼Œç³»ç»Ÿä¼šé«˜äº®æ¨èæ“ä½œã€‚</li>
                    <li>ç‚¹å‡» <span class="font-bold text-blue-700">æŸ¥çœ‹ç­”æ¡ˆ</span> å¯æ˜¾ç¤ºå®Œæ•´æ ‡å‡†åˆ†æè¿‡ç¨‹ã€‚</li>
                  </ul>
                </div>
              </div>
            </div>

            <h3 class="text-lg font-semibold text-gray-900 mb-4">è¾“å…¥ä¸²åˆ†æè¡¨ï¼ˆç­”é¢˜åŒºï¼‰</h3>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="flex flex-wrap gap-2 mb-4">
              <button @click="onMatch"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium">
                åŒ¹é…
              </button>
              <button @click="onUndo" :disabled="userSteps.length <= 1"
                class="px-4 py-2 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium">
                å›é€€
              </button>
              <button @click="onShowAnswer"
                class="px-4 py-2 border border-blue-300 text-blue-700 bg-white rounded-lg hover:bg-blue-50 transition-colors text-sm font-medium">
                {{ showAnswer ? 'éšè—ç­”æ¡ˆ' : 'æŸ¥çœ‹ç­”æ¡ˆ' }}
              </button>
              <button @click="onResetUserSteps"
                class="px-4 py-2 border border-gray-300 text-gray-700 bg-white rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium">
                é‡åš
              </button>
              <button @click="onHint"
                class="px-4 py-2 border border-yellow-400 text-yellow-700 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors text-sm font-medium">
                æç¤º
              </button>
            </div>

            <!-- ç­”é¢˜è¡¨æ ¼ -->
            <div class="overflow-x-auto">
              <table class="min-w-full border border-gray-300 text-sm user-steps-table">
                <thead class="bg-gray-50">
                  <tr>
                    <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">æ­¥éª¤</th>
                    <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">åˆ†ææ ˆ</th>
                    <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">è¾“å…¥ä¸²</th>
                  </tr>
                </thead>
                <tbody class="bg-white">
                  <tr v-for="(step, idx) in userSteps" :key="idx">
                    <td class="border border-gray-300 px-3 py-2 text-center">{{ idx + 1 }}</td>
                    <td class="border border-gray-300 px-3 py-2 font-mono text-center">
                      <template v-if="idx === userSteps.length - 1 && hintActive && hintType === 'match'">
                        <span v-for="(ch, i) in (step.stack || '')" :key="i"
                          :class="i === (step.stack.length || 1) - 1 ? 'bg-yellow-200 text-yellow-800 px-1 rounded' : ''">
                          {{ ch }}
                        </span>
                      </template>
                      <template v-else-if="idx === userSteps.length - 1 && hintActive && hintType === 'll1'">
                        <span v-for="(ch, i) in (step.stack || '')" :key="i"
                          :class="i === (step.stack.length || 1) - 1 ? 'bg-yellow-200 text-yellow-800 px-1 rounded' : ''">
                          {{ ch }}
                        </span>
                      </template>
                      <template v-else>
                        {{ step.stack }}
                      </template>
                    </td>
                    <td class="border border-gray-300 px-3 py-2 font-mono text-center">
                      <template v-if="idx === userSteps.length - 1 && hintActive && hintType === 'match'">
                        <span v-for="(ch, i) in (step.input || '')" :key="i"
                          :class="i === 0 ? 'bg-yellow-200 text-yellow-800 px-1 rounded' : ''">
                          {{ ch }}
                        </span>
                      </template>
                      <template v-else-if="idx === userSteps.length - 1 && hintActive && hintType === 'll1'">
                        <span v-for="(ch, i) in (step.input || '')" :key="i"
                          :class="i === 0 ? 'bg-yellow-200 text-yellow-800 px-1 rounded' : ''">
                          {{ ch }}
                        </span>
                      </template>
                      <template v-else>
                        {{ step.input }}
                      </template>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- åˆ†æç»“æœè¡¨æ ¼ï¼ˆç­”æ¡ˆï¼‰- åªåœ¨ç‚¹å‡»æŸ¥çœ‹ç­”æ¡ˆæ—¶æ˜¾ç¤º -->
    <div v-if="inputAnalysisResult && showAnswer"
      class="bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 rounded-xl shadow-lg border border-green-100 p-6 mb-6">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-3">
          <div
            class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center">
            <Icon icon="lucide:check-circle" class="w-5 h-5 text-white" />
          </div>
          <div>
            <h3 class="text-xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">
              æ ‡å‡†ç­”æ¡ˆåˆ†æè¡¨
            </h3>
            <p class="text-sm text-gray-600 mt-1">å®Œæ•´çš„LL1åˆ†æè¿‡ç¨‹</p>
          </div>
        </div>
        <div class="flex items-center gap-2 px-3 py-1.5 bg-green-100 rounded-full">
          <Icon icon="lucide:eye" class="w-3 h-3 text-green-600" />
          <span class="text-xs font-medium text-green-700">æŸ¥çœ‹ç­”æ¡ˆæ¨¡å¼</span>
        </div>
      </div>

      <div class="bg-white rounded-lg border border-green-200 p-4 shadow-sm">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-3">
            <Icon :icon="inputAnalysisResult.info_res === 'Success!' ? 'lucide:check-circle' : 'lucide:x-circle'"
              class="w-6 h-6"
              :class="inputAnalysisResult.info_res === 'Success!' ? 'text-green-600' : 'text-red-600'" />
            <h4 class="text-lg font-semibold"
              :class="inputAnalysisResult.info_res === 'Success!' ? 'text-green-700' : 'text-red-700'">
              {{ inputAnalysisResult.info_res === 'Success!' ? 'å­—ç¬¦ä¸²åˆ†ææˆåŠŸï¼' : 'å­—ç¬¦ä¸²åˆ†æå¤±è´¥ï¼' }}
            </h4>
          </div>
          <div class="text-sm text-gray-500">
            åˆ†æç»“æœï¼š{{ inputAnalysisResult.info_res }}
          </div>
        </div>

        <!-- åˆ†æè¿‡ç¨‹è¡¨æ ¼ -->
        <div class="overflow-x-auto">
          <table class="min-w-full border border-gray-300 text-sm">
            <thead class="bg-green-50">
              <tr>
                <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">
                  æ­¥éª¤
                </th>
                <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">
                  æ ˆ
                </th>
                <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">
                  è¾“å…¥
                </th>
                <th class="border border-gray-300 px-3 py-2 text-center font-medium text-gray-700">
                  åŠ¨ä½œ
                </th>
              </tr>
            </thead>
            <tbody class="bg-white">
              <tr v-for="(step, index) in inputAnalysisResult.info_step" :key="index">
                <td class="border border-gray-300 px-3 py-2 text-center">{{ step }}</td>
                <td class="border border-gray-300 px-3 py-2 font-mono text-center">
                  {{ inputAnalysisResult.info_state_stack?.[index] || '' }}
                </td>
                <td class="border border-gray-300 px-3 py-2 font-mono text-center">
                  {{ inputAnalysisResult.info_str?.[index] || '' }}
                </td>
                <td class="border border-gray-300 px-3 py-2 text-center">
                  {{ inputAnalysisResult.info_msg?.[index] || '' }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="step-actions">
      <div class="flex justify-between items-center">
        <button @click="$emit('prev-step')"
          class="px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
          <Icon icon="lucide:chevron-left" class="w-4 h-4 inline mr-2" />
          ä¸Šä¸€æ­¥
        </button>
        <div class="text-sm text-gray-500">æ­¥éª¤ 4 / 4</div>
        <button @click="complete"
          class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
          å®Œæˆ
          <Icon icon="lucide:check" class="w-4 h-4 inline ml-2" />
        </button>
      </div>
    </div>

    <!-- æ¶ˆæ¯æç¤º -->
    <transition name="fade">
      <div v-if="message" class="fixed bottom-8 right-8 z-50 px-6 py-3 rounded-lg shadow-lg flex items-center gap-2"
        :class="messageType === 'success' ? 'bg-green-600 text-white' : 'bg-red-600 text-white'">
        <Icon :icon="messageType === 'success' ? 'lucide:check-circle' : 'lucide:alert-circle'" class="w-5 h-5" />
        <span>{{ message }}</span>
      </div>
    </transition>

    <!-- é£è¡ŒåŠ¨ç”»å…ƒç´  -->
    <div v-for="flyingSymbol in flyingSymbols" :key="`${flyingSymbol.symbol}-${flyingSymbol.target}`"
      class="fixed z-50 pointer-events-none" :style="{
        left: flyingSymbol.x + 'px',
        top: flyingSymbol.y + 'px',
        transform: 'translate(-50%, -50%)'
      }">
      <div class="bg-orange-500 text-white px-2 py-1 rounded-md text-xs font-mono shadow-lg border border-orange-600">
        {{ flyingSymbol.symbol }}
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue'
import { storeToRefs } from 'pinia'
import { useLL1Store } from '@/stores/ll1'
import { useCommonStore } from '@/stores/common'
import { Icon } from '@iconify/vue'

// ç»„ä»¶äº‹ä»¶
const emit = defineEmits<{ 'next-step': []; 'prev-step': []; complete: [data: any] }>()

// ä½¿ç”¨ Store
const ll1Store = useLL1Store()
const commonStore = useCommonStore()

// ä» Store è·å–æ•°æ®
const { originalData, inputString, inputAnalysisResult } = storeToRefs(ll1Store)
const { loading } = storeToRefs(commonStore)

// æœ¬åœ°çŠ¶æ€
const analyzing = computed(() => loading.value)

// ç¤ºä¾‹å­—ç¬¦ä¸² (ä¸åŒ…å«ç»“æŸç¬¦ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ #)
const exampleStrings = ['a', 'ab', 'aab', 'b']

// ç­”é¢˜ç›¸å…³çŠ¶æ€
const userSteps = ref<{ stack: string; input: string }[]>([])
const showAnswer = ref(false)
const hintActive = ref(false)
const hintRow = ref('')
const hintCol = ref('')
const hintType = ref<'ll1' | 'match' | ''>('')
const message = ref<string | null>(null)
const messageType = ref<'success' | 'error'>('success')
let messageTimer: number | null = null

// é£è¡ŒåŠ¨ç”»çŠ¶æ€
const flyingSymbols = ref<Array<{
  symbol: string,
  target: string,
  x: number,
  y: number
}>>([])

// è®¡ç®—å±æ€§
const VtAll = computed(() => {
  const vt = originalData.value?.Vt || []
  return [...vt, '#'] // æ·»åŠ ç»“æŸç¬¦
})

// æ£€æŸ¥åˆ†ææ˜¯å¦å®Œæˆ
const isAnalysisComplete = computed(() => {
  if (userSteps.value.length === 0) return false
  const last = userSteps.value[userSteps.value.length - 1]
  return last.stack === '#' && last.input === '#'
})

// ç›‘å¬åˆ†æç»“æœå˜åŒ–ï¼Œè‡ªåŠ¨åˆå§‹åŒ–ç”¨æˆ·æ­¥éª¤
watch(inputAnalysisResult, (newResult) => {
  if (newResult && inputString.value) {
    initUserSteps()
  }
}, { immediate: true })

// åˆ†æå­—ç¬¦ä¸²
const analyzeString = async () => {
  if (!inputString.value?.trim()) {
    commonStore.setError('è¯·è¾“å…¥è¦åˆ†æçš„å­—ç¬¦ä¸²')
    return
  }

  try {
    const success = await ll1Store.analyzeInputString()

    if (success) {
      console.log('å­—ç¬¦ä¸²åˆ†æå®Œæˆï¼')
      // åˆå§‹åŒ–ç”¨æˆ·ç­”é¢˜æ­¥éª¤
      initUserSteps()
    }
  } catch (error) {
    console.error('åˆ†æå¤±è´¥:', error)
    commonStore.setError('åˆ†æè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯')
  }
}

// é‡ç½®åˆ†æ
const resetAnalysis = () => {
  ll1Store.setInputString('')
  commonStore.clearError()
  userSteps.value = []
  showAnswer.value = false
  hintActive.value = false
  hintRow.value = ''
  hintCol.value = ''
  hintType.value = ''
  flyingSymbols.value = []
}

// åˆå§‹åŒ–ç”¨æˆ·ç­”é¢˜æ­¥éª¤
const initUserSteps = () => {
  showAnswer.value = false
  if (originalData.value && inputString.value && inputAnalysisResult.value) {
    // åˆå§‹åˆ†ææ ˆå’Œè¾“å…¥ä¸²
    const startSymbol = originalData.value.Vn[0] || ''
    // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„ç¬¬ä¸€ä¸ªè¾“å…¥ä¸²ï¼Œç¡®ä¿æ ¼å¼ä¸€è‡´
    const initialInput = inputAnalysisResult.value.info_str[0] || ''
    userSteps.value = [{ stack: '#' + startSymbol, input: initialInput }]
  } else {
    userSteps.value = []
  }
}

// LL1è¡¨åŒå‡»
const onLL1CellDblClick = (row: string, col: string) => {
  if (hintActive.value) {
    hintActive.value = false
    hintRow.value = ''
    hintCol.value = ''
    hintType.value = ''
  }
  const prod = originalData.value?.table?.[row + '|' + col]
  if (!prod) return
  const last = userSteps.value[userSteps.value.length - 1]
  if (!last) return

  // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆåˆ†æ
  if (last.stack === '#' && last.input === '#') {
    showMessage('åˆ†æå·²å®Œæˆï¼', 'success')
    return
  }

  // åˆ¤æ–­æ ˆé¡¶å’Œå½“å‰è¾“å…¥ç¬¦å·
  const stackArr = last.stack.split('')
  const top = stackArr[stackArr.length - 1]
  if (top !== row) {
    showMessage('è¯·å…ˆå¤„ç†æ ˆé¡¶ç¬¦å·: ' + top, 'error')
    return
  }
  // æ¨å¯¼äº§ç”Ÿå¼
  stackArr.pop()
  if (prod !== 'Îµ') {
    for (let i = prod.length - 1; i >= 0; i--) {
      stackArr.push(prod[i])
    }
  }
  const newStack = stackArr.join('')
  userSteps.value.push({ stack: newStack, input: last.input })

  // æ£€æŸ¥æ˜¯å¦å®Œæˆåˆ†æï¼ˆè™½ç„¶è¿™é‡Œé€šå¸¸ä¸ä¼šå®Œæˆï¼Œä½†ä¸ºäº†å®Œæ•´æ€§ï¼‰
  if (newStack === '#' && last.input === '#') {
    showMessage('åˆ†æå®Œæˆï¼', 'success')
  }
}

// åŒ¹é…æŒ‰é’®
const onMatch = () => {
  const last = userSteps.value[userSteps.value.length - 1]
  if (!last) return

  // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆåˆ†æ
  if (last.stack === '#' && last.input === '#') {
    showMessage('åˆ†æå·²å®Œæˆï¼', 'success')
    return
  }

  const stackArr = last.stack.split('')
  const inputArr = last.input.split('')
  const top = stackArr[stackArr.length - 1]
  const cur = inputArr[0]
  if (top === cur) {
    stackArr.pop()
    inputArr.shift()
    const newStack = stackArr.join('')
    const newInput = inputArr.join('')
    userSteps.value.push({ stack: newStack, input: newInput })

    // æ£€æŸ¥æ˜¯å¦å®Œæˆåˆ†æ
    if (newStack === '#' && newInput === '#') {
      showMessage('åˆ†æå®Œæˆï¼', 'success')
    }
  } else {
    showMessage('æ ˆé¡¶ç¬¦å·ä¸è¾“å…¥ä¸²é¦–å­—ç¬¦ä¸åŒ¹é…ï¼', 'error')
  }
}

// å›é€€æŒ‰é’®
const onUndo = () => {
  if (userSteps.value.length > 1) {
    userSteps.value.pop()
  }
}

// æŸ¥çœ‹ç­”æ¡ˆ
const onShowAnswer = () => {
  showAnswer.value = !showAnswer.value
}

// é‡åš
const onResetUserSteps = () => {
  initUserSteps()
  hintActive.value = false
  hintRow.value = ''
  hintCol.value = ''
  hintType.value = ''
  flyingSymbols.value = []
}

// æç¤ºæŒ‰é’®
const onHint = async () => {
  const last = userSteps.value[userSteps.value.length - 1]
  if (!last) return

  // æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆåˆ†æ
  if (last.stack === '#' && last.input === '#') {
    showMessage('åˆ†æå·²å®Œæˆï¼', 'success')
    return
  }

  const stackArr = last.stack.split('')
  const inputArr = last.input.split('')
  const top = stackArr[stackArr.length - 1]
  const cur = inputArr[0]

  // åŒ¹é…æƒ…å½¢
  if (top === cur) {
    hintActive.value = true
    hintType.value = 'match'

    // æ‰§è¡ŒåŒ¹é…é£è¡ŒåŠ¨ç”»
    await executeMatchFlyingAnimation(top, cur)

    setTimeout(() => {
      onMatch()
      hintActive.value = false
      hintType.value = ''
    }, 800)
    return
  }

  // LL1è¡¨æ¨å¯¼æƒ…å½¢
  const prod = originalData.value?.table?.[top + '|' + cur]
  if (prod) {
    hintActive.value = true
    hintRow.value = top
    hintCol.value = cur
    hintType.value = 'll1'

    // æ‰§è¡ŒLL1æ¨å¯¼é£è¡ŒåŠ¨ç”»
    await executeLL1FlyingAnimation(top, cur, prod)

    setTimeout(() => {
      onLL1CellDblClick(top, cur)
      hintActive.value = false
      hintRow.value = ''
      hintCol.value = ''
      hintType.value = ''
    }, 800)
    return
  }
  showMessage('æç¤ºå·²å®Œæˆ', 'success')
}

// æ‰§è¡ŒåŒ¹é…é£è¡ŒåŠ¨ç”»
const executeMatchFlyingAnimation = async (symbol: string, target: string) => {
  // æŸ¥æ‰¾ç¬¦å·å¡ç‰‡å…ƒç´ ï¼ˆä»ç¬¦å·å¡ç‰‡åŒºåŸŸï¼‰
  const symbolElement = document.querySelector(`[data-symbol="${symbol}"]`) as HTMLElement
  const stackElement = document.querySelector('.user-steps-table tbody tr:last-child td:nth-child(2)') as HTMLElement
  const inputElement = document.querySelector('.user-steps-table tbody tr:last-child td:nth-child(3)') as HTMLElement

  if (!symbolElement || !stackElement || !inputElement) {
    return
  }

  const symbolRect = symbolElement.getBoundingClientRect()
  const stackRect = stackElement.getBoundingClientRect()
  const inputRect = inputElement.getBoundingClientRect()

  // åˆ›å»ºé£è¡ŒåŠ¨ç”»ï¼šä»ç¬¦å·å¡ç‰‡é£åˆ°æ ˆé¡¶
  flyingSymbols.value.push({
    symbol: symbol,
    target: 'stack',
    x: symbolRect.left + symbolRect.width / 2,
    y: symbolRect.top + symbolRect.height / 2
  })

  // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©å…ƒç´ å‡ºç°
  await new Promise(resolve => setTimeout(resolve, 100))

  // æ›´æ–°ä½ç½®åˆ°æ ˆé¡¶
  const flyingSymbolData = flyingSymbols.value.find(fs => fs.symbol === symbol && fs.target === 'stack')
  if (flyingSymbolData) {
    flyingSymbolData.x = stackRect.left + stackRect.width / 2
    flyingSymbolData.y = stackRect.top + stackRect.height / 2
  }

  // ç­‰å¾…é£è¡ŒåŠ¨ç”»å®Œæˆ
  await new Promise(resolve => setTimeout(resolve, 1500))

  // æ¸…é™¤é£è¡ŒåŠ¨ç”»çŠ¶æ€
  flyingSymbols.value = flyingSymbols.value.filter(
    fs => !(fs.symbol === symbol && fs.target === 'stack')
  )

  // åˆ›å»ºç¬¬äºŒä¸ªé£è¡ŒåŠ¨ç”»ï¼šä»è¾“å…¥ä¸²é¦–å­—ç¬¦é£å‡º
  flyingSymbols.value.push({
    symbol: target,
    target: 'input',
    x: inputRect.left + inputRect.width / 2,
    y: inputRect.top + inputRect.height / 2
  })

  await new Promise(resolve => setTimeout(resolve, 100))

  // é£å‡ºåˆ°å±å¹•å¤–
  const flyingSymbolData2 = flyingSymbols.value.find(fs => fs.symbol === target && fs.target === 'input')
  if (flyingSymbolData2) {
    flyingSymbolData2.x = inputRect.left + inputRect.width / 2
    flyingSymbolData2.y = -100 // é£å‡ºåˆ°å±å¹•ä¸Šæ–¹
  }

  await new Promise(resolve => setTimeout(resolve, 1000))

  // æ¸…é™¤ç¬¬äºŒä¸ªé£è¡ŒåŠ¨ç”»çŠ¶æ€
  flyingSymbols.value = flyingSymbols.value.filter(
    fs => !(fs.symbol === target && fs.target === 'input')
  )
}

// æ‰§è¡ŒLL1æ¨å¯¼é£è¡ŒåŠ¨ç”»
const executeLL1FlyingAnimation = async (nonTerminal: string, terminal: string, production: string) => {
  // æŸ¥æ‰¾LL1è¡¨æ ¼ä¸­çš„äº§ç”Ÿå¼å…ƒç´ 
  const tableCellElement = document.querySelector(`[data-table-cell="${nonTerminal}|${terminal}"]`) as HTMLElement
  const stackElement = document.querySelector('.user-steps-table tbody tr:last-child td:nth-child(2)') as HTMLElement

  if (!tableCellElement || !stackElement) {
    return
  }

  const tableCellRect = tableCellElement.getBoundingClientRect()
  const stackRect = stackElement.getBoundingClientRect()

  // åˆ›å»ºé£è¡ŒåŠ¨ç”»ï¼šä»LL1è¡¨æ ¼é£åˆ°æ ˆé¡¶
  flyingSymbols.value.push({
    symbol: production,
    target: 'stack',
    x: tableCellRect.left + tableCellRect.width / 2,
    y: tableCellRect.top + tableCellRect.height / 2
  })

  // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©å…ƒç´ å‡ºç°
  await new Promise(resolve => setTimeout(resolve, 100))

  // æ›´æ–°ä½ç½®åˆ°æ ˆé¡¶
  const flyingSymbolData = flyingSymbols.value.find(fs => fs.symbol === production && fs.target === 'stack')
  if (flyingSymbolData) {
    flyingSymbolData.x = stackRect.left + stackRect.width / 2
    flyingSymbolData.y = stackRect.top + stackRect.height / 2
  }

  // ç­‰å¾…é£è¡ŒåŠ¨ç”»å®Œæˆ
  await new Promise(resolve => setTimeout(resolve, 1500))

  // æ¸…é™¤é£è¡ŒåŠ¨ç”»çŠ¶æ€
  flyingSymbols.value = flyingSymbols.value.filter(
    fs => !(fs.symbol === production && fs.target === 'stack')
  )
}



// æ˜¾ç¤ºæ¶ˆæ¯
const showMessage = (msg: string, type: 'success' | 'error' = 'success') => {
  message.value = msg
  messageType.value = type
  if (messageTimer) clearTimeout(messageTimer)
  messageTimer = window.setTimeout(() => {
    message.value = null
  }, 2000)
}

// å®Œæˆæ­¥éª¤
const complete = () => {
  const data = {
    inputString: inputString.value,
    analysisResult: inputAnalysisResult.value,
    success: inputAnalysisResult.value?.info_res === 'Success!',
    steps: inputAnalysisResult.value?.info_step || [],
    messages: inputAnalysisResult.value?.info_msg || [],
    userSteps: userSteps.value,
  }

  emit('complete', data)
}
</script>

<style scoped>
.step-header {
  padding: 2rem 2rem 1rem;
  border-bottom: 1px solid #e5e7eb;
}

.step-icon {
  width: 3rem;
  height: 3rem;
  background: #dcfce7;
  border-radius: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.step-content {
  padding: 2rem;
}

.step-actions {
  padding: 1rem 2rem 2rem;
  border-top: 1px solid #e5e7eb;
  background: #f9fafb;
}

/* æç¤ºé«˜äº®æ ·å¼ */
.hint-highlight {
  background: #facc15;
  color: #b45309;
  border-radius: 0.25rem;
  padding: 0 2px;
}

/* è¿‡æ¸¡åŠ¨ç”» */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

/* é£è¡ŒåŠ¨ç”»è¿‡æ¸¡æ•ˆæœ */
.fixed {
  transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1);
}

/* é«˜äº®åŠ¨ç”»æ•ˆæœ */
@keyframes highlight-pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.7;
  }
}

.ring-yellow-400 {
  animation: highlight-pulse 1s ease-in-out infinite;
}
</style>
