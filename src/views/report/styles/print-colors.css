/* 全局打印背景颜色保留样式 */
/* 在所有报告组件中引入此文件即可 */

@media print {
  /* 通用保留背景色类 */
  .print-keep-colors,
  .fa-report-page,
  .ll1-report-page,
  .lr0-report-page,
  .slr1-report-page,
  .fa-step3-detailed-report,
  .fa-step5-detailed-report,
  .fa-table-report,
  .fa-canvas-report,
  .ll1-step2-report,
  .ll1-step3-report,
  .ll1-step4-report,
  .lr0-step2-report,
  .lr0-step3-report,
  .lr0-step4-report,
  .lr0-step5-report,
  .slr1-step2-report,
  .slr1-step3-report,
  .slr1-step4-report,
  .slr1-step5-report,
  .ai-report-section,
  .report-error-list,
  .report-progress-card {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* 所有子元素也保留背景色 */
  .print-keep-colors *,
  .fa-report-page *,
  .ll1-report-page *,
  .lr0-report-page *,
  .slr1-report-page *,
  .fa-step3-detailed-report *,
  .fa-step5-detailed-report *,
  .fa-table-report *,
  .fa-canvas-report *,
  .ll1-step2-report *,
  .ll1-step3-report *,
  .ll1-step4-report *,
  .lr0-step2-report *,
  .lr0-step3-report *,
  .lr0-step4-report *,
  .lr0-step5-report *,
  .slr1-step2-report *,
  .slr1-step3-report *,
  .slr1-step4-report *,
  .slr1-step5-report *,
  .ai-report-section *,
  .report-error-list *,
  .report-progress-card * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* 打印时强制双列布局（用于绘图对比） */
  .fa-canvas-report .grid,
  .fa-canvas-report :deep(.grid) {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 0.75rem !important;
  }

  /* 确保绘图容器在打印时不被截断 */
  .fa-canvas-report .grid > div,
  .fa-canvas-report :deep(.grid > div) {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }

  /* 调整绘图容器样式，提高空间利用率 */
  .fa-canvas-report .graph-container,
  .fa-canvas-report :deep(.graph-container) {
    min-height: 150px !important;
    padding: 0.25rem !important;
    width: 100% !important;
  }

  /* 学生信息打印优化 - 防止换行 */
  .student-info-grid,
  .student-info :deep(.student-info-grid) {
    display: flex !important;
    flex-wrap: nowrap !important;
    justify-content: center !important;
    gap: 40px !important;
  }

  .student-info-item,
  .student-info :deep(.student-info-item) {
    display: flex !important;
    align-items: center !important;
    white-space: nowrap !important;
    flex-shrink: 0 !important;
  }

  .student-info-label,
  .student-info :deep(.student-info-label) {
    white-space: nowrap !important;
    margin-right: 8px !important;
  }

  .student-info-value,
  .student-info :deep(.student-info-value) {
    white-space: nowrap !important;
  }

  /* 元数据信息网格 - 打印时4个一排，允许换行 */
  .grid.grid-cols-1.md\\:grid-cols-4,
  .grid.md\\:grid-cols-4,
  [class*="grid-cols-4"],
  :deep(.grid.grid-cols-1.md\\:grid-cols-4),
  :deep(.grid.md\\:grid-cols-4) {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    gap: 8px !important;
    width: 100% !important;
    max-width: 100% !important;
  }

  /* 元数据卡片子项 - 4个一排 */
  .grid.grid-cols-1.md\\:grid-cols-4 > div,
  .grid.md\\:grid-cols-4 > div,
  [class*="grid-cols-4"] > div,
  :deep(.grid.grid-cols-1.md\\:grid-cols-4 > div),
  :deep(.grid.md\\:grid-cols-4 > div) {
    flex: 1 1 calc(25% - 6px) !important;
    min-width: 140px !important;
    max-width: calc(25% - 6px) !important;
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  /* 元数据标题样式优化 */
  .grid h2,
  :deep(.grid h2) {
    font-size: 11px !important;
    margin-bottom: 3px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  /* 元数据值容器样式优化 */
  .grid [class*="rounded-lg"],
  :deep(.grid [class*="rounded-lg"]) {
    padding: 4px 6px !important;
    font-size: 10px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  /* 元数据值文字样式 */
  .grid [class*="font-mono"],
  .grid [class*="text-lg"],
  .grid [class*="text-base"],
  :deep(.grid [class*="font-mono"]),
  :deep(.grid [class*="text-lg"]),
  :deep(.grid [class*="text-base"]) {
    font-size: 10px !important;
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  /* 文法产生式容器 - 打印时允许换行 */
  .grid [class*="whitespace-pre-wrap"],
  :deep(.grid [class*="whitespace-pre-wrap"]) {
    white-space: pre-wrap !important;
    word-wrap: break-word !important;
    word-break: break-all !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }

  /* 正则表达式/文法产生式容器 - 打印时允许换行 */
  .grid .break-all,
  :deep(.grid .break-all) {
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: break-all !important;
    overflow: visible !important;
    text-overflow: clip !important;
  }

  /* 步骤进度卡片网格 - 打印时强制2列 */
  .grid.grid-cols-1.lg\\:grid-cols-2,
  .grid.lg\\:grid-cols-2,
  :deep(.grid.grid-cols-1.lg\\:grid-cols-2),
  :deep(.grid.lg\\:grid-cols-2) {
    display: grid !important;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px !important;
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
  }

  /* 步骤进度卡片子项 */
  .grid.grid-cols-1.lg\\:grid-cols-2 > div,
  .grid.lg\\:grid-cols-2 > div,
  :deep(.grid.grid-cols-1.lg\\:grid-cols-2 > div),
  :deep(.grid.lg\\:grid-cols-2 > div) {
    min-width: 0 !important;
    max-width: 100% !important;
    overflow: hidden !important;
  }

  /* 步骤进度卡片防止分页切割 */
  .grid > div[class*="rounded-xl"],
  .grid > div[class*="shadow-sm"],
  .grid > div[class*="border"],
  :deep(.grid > div[class*="rounded-xl"]),
  :deep(.grid > div[class*="shadow-sm"]),
  :deep(.grid > div[class*="border"]) {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    margin-bottom: 0 !important;
  }

  /* 错误列表中的提示信息换行 */
  .report-error-list .bg-amber-50,
  .report-error-list .bg-blue-50,
  .report-error-list .bg-purple-50,
  :deep(.report-error-list .bg-amber-50),
  :deep(.report-error-list .bg-blue-50),
  :deep(.report-error-list .bg-purple-50) {
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: break-all !important;
  }

  /* 错误列表网格布局 */
  .report-error-list .grid.grid-cols-2,
  :deep(.report-error-list .grid.grid-cols-2) {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 8px !important;
  }

  .report-error-list .grid.grid-cols-2 > div,
  :deep(.report-error-list .grid.grid-cols-2 > div) {
    min-width: 0 !important;
    overflow: hidden !important;
  }

  .report-error-list .font-mono,
  :deep(.report-error-list .font-mono) {
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: break-all !important;
    font-size: 9px !important;
  }

  /* 错误统计卡片网格 - 打印时强制横向排列 */
  .grid.grid-cols-1.md\:grid-cols-3,
  .grid.grid-cols-2.md\:grid-cols-4,
  .grid.grid-cols-2.md\:grid-cols-5,
  .grid.md\:grid-cols-3,
  .grid.md\:grid-cols-4,
  .grid.md\:grid-cols-5,
  :deep(.grid.grid-cols-1.md\:grid-cols-3),
  :deep(.grid.grid-cols-2.md\:grid-cols-4),
  :deep(.grid.grid-cols-2.md\:grid-cols-5),
  :deep(.grid.md\:grid-cols-3),
  :deep(.grid.md\:grid-cols-4),
  :deep(.grid.md\:grid-cols-5) {
    display: flex !important;
    flex-direction: row !important;
    flex-wrap: wrap !important;
    gap: 12px !important;
  }

  /* 错误统计卡片子项 - 横向排列 */
  .grid.grid-cols-1.md\:grid-cols-3 > div,
  .grid.grid-cols-2.md\:grid-cols-4 > div,
  .grid.grid-cols-2.md\:grid-cols-5 > div,
  .grid.md\:grid-cols-3 > div,
  .grid.md\:grid-cols-4 > div,
  .grid.md\:grid-cols-5 > div,
  :deep(.grid.grid-cols-1.md\:grid-cols-3 > div),
  :deep(.grid.grid-cols-2.md\:grid-cols-4 > div),
  :deep(.grid.grid-cols-2.md\:grid-cols-5 > div),
  :deep(.grid.md\:grid-cols-3 > div),
  :deep(.grid.md\:grid-cols-4 > div),
  :deep(.grid.md\:grid-cols-5 > div) {
    flex: 1 1 auto !important;
    min-width: 120px !important;
    max-width: calc(50% - 6px) !important;
    break-inside: avoid !important;
    page-break-inside: avoid !important;
  }

  /* FA步骤3表格打印优化 */
  .fa-step3-detailed-report table,
  :deep(.fa-step3-detailed-report table) {
    font-size: 10px !important;
  }

  .fa-step3-detailed-report th,
  .fa-step3-detailed-report td,
  :deep(.fa-step3-detailed-report th),
  :deep(.fa-step3-detailed-report td) {
    padding: 2px 4px !important;
    font-size: 10px !important;
  }

  .fa-step3-detailed-report .answer-item,
  :deep(.fa-step3-detailed-report .answer-item) {
    padding: 1px 2px !important;
    font-size: 9px !important;
  }

  .fa-step3-detailed-report .font-mono,
  :deep(.fa-step3-detailed-report .font-mono) {
    font-size: 9px !important;
  }

  /* LL1步骤3预测分析表打印优化 */
  .ll1-step3-report table,
  :deep(.ll1-step3-report table) {
    font-size: 9px !important;
  }

  .ll1-step3-report th,
  .ll1-step3-report td,
  :deep(.ll1-step3-report th),
  :deep(.ll1-step3-report td) {
    padding: 2px 3px !important;
    font-size: 9px !important;
  }

  .ll1-step3-report th:first-child,
  :deep(.ll1-step3-report th:first-child) {
    width: 40px !important;
    padding: 2px !important;
  }

  .ll1-step3-report td:first-child,
  :deep(.ll1-step3-report td:first-child) {
    width: 40px !important;
    padding: 2px !important;
  }

  .ll1-step3-report .answer-item,
  :deep(.ll1-step3-report .answer-item) {
    padding: 1px 2px !important;
    font-size: 8px !important;
  }

  .ll1-step3-report .font-mono,
  :deep(.ll1-step3-report .font-mono) {
    font-size: 8px !important;
  }

  .ll1-step3-report .text-sm,
  :deep(.ll1-step3-report .text-sm) {
    font-size: 8px !important;
  }

  /* SVG 图表最大化利用空间 */
  .fa-canvas-report :deep(.rendered-svg-container),
  .fa-canvas-report :deep(.viz-wrapper) {
    width: 100% !important;
    height: 100% !important;
  }

  .fa-canvas-report :deep(.rendered-svg-container svg) {
    width: 100% !important;
    height: auto !important;
    max-height: 280px !important;
    object-fit: contain !important;
  }
}
